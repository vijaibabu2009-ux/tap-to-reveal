<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial; background:#f5f5f5; }
    .box { width:420px; margin:80px auto; padding:20px; background:#fff; border-radius:6px; }
    select, textarea, button { width:100%; padding:10px; margin-top:10px; }
    button { background:#2c3e50; color:#fff; border:none; cursor:pointer; }
    .link { margin-top:10px; background:#eef; padding:10px; }
  </style>
</head>
<body>

<div class="box">
  <h3>Create Tap-to-Reveal Link</h3>

  <select id="lang">
    <option value="en">English</option>
    <option value="ta">Tamil</option>
  </select>

  <select id="mode">
    <option value="one">One Time</option>
    <option value="always">Always Active</option>
  </select>

  <textarea id="message" placeholder="Secret message"></textarea>

  <button onclick="createLink()">Generate Link</button>

  <div id="result" class="link"></div>

  <button onclick="logout()" style="background:#c0392b;">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
   apiKey: "AIzaSyDAlt16C36DGhonXf10URIhz82LroH2k3A",
  authDomain: "tap-to-reveal.firebaseapp.com",
  projectId: "tap-to-reveal",
  storageBucket: "tap-to-reveal.firebasestorage.app",
  messagingSenderId: "878205314791",
  appId: "1:878205314791:web:ce3c831e7075c27ca8a442"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ðŸ”’ AUTH GUARD â€“ STOPS FLICKER */
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "admin.html";
  }
});

async function createLink() {
  const user = auth.currentUser;
  if (!user) return alert("Login expired. Reload.");

  try {
    const doc = await db.collection("links").add({
      message: message.value,
      language: lang.value,
      mode: mode.value,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    result.innerHTML =
      `Link:<br>
      <a target="_blank"
      href="../index.html?id=${doc.id}">
      https://vijaibabu2009-ux.github.io/tap-to-reveal/?id=${doc.id}
      </a>`;
  } catch (e) {
    alert(e.message);
  }
}

function logout() {
  auth.signOut().then(() => location.href="admin.html");
}
</script>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial; background:#f5f5f5; }
    .box { width:420px; margin:80px auto; padding:20px; background:#fff; border-radius:6px; }
    select, textarea, button { width:100%; padding:10px; margin-top:10px; }
    button { background:#2c3e50; color:#fff; border:none; cursor:pointer; }
    .link { margin-top:10px; background:#eef; padding:10px; }
  </style>
</head>
<body>

<div class="box">
  <h3>Create Tap-to-Reveal Link</h3>

  <select id="lang">
    <option value="en">English</option>
    <option value="ta">Tamil</option>
  </select>

  <select id="mode">
    <option value="one">One Time</option>
    <option value="always">Always Active</option>
  </select>

  <textarea id="message" placeholder="Secret message"></textarea>

  <button onclick="createLink()">Generate Link</button>

  <div id="result" class="link"></div>

  <button onclick="logout()" style="background:#c0392b;">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "tap-to-reveal.firebaseapp.com",
  projectId: "tap-to-reveal"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ðŸ”’ AUTH GUARD â€“ STOPS FLICKER */
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "admin.html";
  }
});

async function createLink() {
  const user = auth.currentUser;
  if (!user) return alert("Login expired. Reload.");

  try {
    const doc = await db.collection("links").add({
      message: message.value,
      language: lang.value,
      mode: mode.value,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    result.innerHTML =
      `Link:<br>
      <a target="_blank"
      href="../index.html?id=${doc.id}">
      https://vijaibabu2009-ux.github.io/tap-to-reveal/?id=${doc.id}
      </a>`;
  } catch (e) {
    alert(e.message);
  }
}

function logout() {
  auth.signOut().then(() => location.href="admin.html");
}
</script>

</body>
</html>
