<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial; background:#f5f7fa; }
    .box { width:400px; margin:80px auto; background:#fff; padding:20px; border-radius:8px; }
    button { width:100%; padding:10px; background:#24364a; color:#fff; border:none; }
  </style>
</head>

<body>

<div class="box">
  <h2>Create Tap-to-Reveal Link</h2>

  <select id="lang">
    <option value="en">English</option>
    <option value="ta">Tamil</option>
  </select><br><br>

  <select id="mode">
    <option value="one">One Time Reveal</option>
    <option value="always">Always Active</option>
  </select><br><br>

  <textarea id="message" placeholder="Secret message"></textarea><br><br>

  <button onclick="createLink()">Generate Link</button>

  <p id="result"></p>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDAlt16C3bGhOnXF10URlzh82LroH2k3A",
  authDomain: "tap-to-reveal.firebaseapp.com",
  projectId: "tap-to-reveal"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

// ðŸ” BLOCK PAGE IF NOT LOGGED IN
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "admin.html";
  }
});

async function createLink() {
  const user = auth.currentUser;

  if (!user) {
    alert("Not logged in");
    return;
  }

  const data = {
    message: message.value,
    lang: lang.value,
    mode: mode.value,
    used: false,
    createdBy: user.uid,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  try {
    const ref = await db.collection("reveals").add(data);
    result.innerHTML =
      `<b>Link:</b><br>
       https://vijaibabu2009-ux.github.io/tap-to-reveal/?id=${ref.id}`;
  } catch (e) {
    alert(e.message);
  }
}
</script>

</body>
</html>
