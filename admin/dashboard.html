<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
  }
  header {
    background:#2c3e50;
    color:#fff;
    padding:12px;
    text-align:center;
  }
  .container {
    max-width:420px;
    margin:40px auto;
    background:#fff;
    padding:25px;
    border-radius:8px;
    box-shadow:0 10px 30px rgba(0,0,0,.15);
  }
  select, textarea, button, input {
    width:100%;
    margin-top:10px;
    padding:10px;
  }
  button {
    background:#2c3e50;
    color:#fff;
    border:none;
    cursor:pointer;
  }
  .result {
    margin-top:15px;
    word-break:break-all;
    background:#eef;
    padding:10px;
    display:none;
  }
</style>
</head>

<body>

<header>
  Admin Dashboard
  <button onclick="logout()" style="float:right;background:#e74c3c">Logout</button>
</header>

<div class="container">
  <h3>Create Tap-to-Reveal Link</h3>

  <select id="lang">
    <option value="en">English</option>
    <option value="ta">Tamil</option>
  </select>

  <select id="mode">
    <option value="one">One Time Reveal</option>
    <option value="always">Always Active</option>
  </select>

  <textarea id="message" placeholder="Secret message..."></textarea>

  <button onclick="generateLink()">Generate Link</button>

  <div id="result" class="result"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ðŸ”´ USE SAME CONFIG AS admin.html
 const firebaseConfig = {
  apiKey: "AIzaSyDAlt16C36DGhonXf10URIhz82LroH2k3A",
  authDomain: "tap-to-reveal.firebaseapp.com",
  projectId: "tap-to-reveal",
  storageBucket: "tap-to-reveal.firebasestorage.app",
  messagingSenderId: "878205314791",
  appId: "1:878205314791:web:ce3c831e7075c27ca8a442"
};


  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();
  const db = firebase.firestore();

  // Session guard
  if (!sessionStorage.getItem("admin")) {
    location.href = "admin.html";
  }

  function logout() {
    sessionStorage.clear();
    auth.signOut().then(() => location.href = "admin.html");
  }

  async function generateLink() {
    const lang = document.getElementById("lang").value;
    const mode = document.getElementById("mode").value;
    const msg  = document.getElementById("message").value.trim();

    if (!msg) {
      alert("Message required");
      return;
    }

    try {
      const ref = await db.collection("secrets").add({
        message: msg,
        language: lang,
        mode: mode,
        used: false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      const link =
        `https://vijaibabu2009-ux.github.io/tap-to-reveal/?id=${ref.id}`;

      const box = document.getElementById("result");
      box.style.display = "block";
      box.innerHTML =
        `<b>Generated Link:</b><br>
         <a href="${link}" target="_blank">${link}</a>`;

    } catch (e) {
      alert("ERROR: " + e.message);
      console.error(e);
    }
  }
</script>

</body>
</html>
