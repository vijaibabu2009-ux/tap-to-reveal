<!DOCTYPE html>
<html>
<head>
  <title>Tap to Reveal</title>
  <meta charset="utf-8" />
  <style>
    body {
      font-family: Arial;
      background:#111;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      text-align:center;
    }
  </style>
</head>
<body>

<h1 id="msg">Tap to reveal...</h1>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDAlt16C36DGhonXf10URIhz82LroH2k3A",
  authDomain: "tap-to-reveal.firebaseapp.com",
  projectId: "tap-to-reveal",
  storageBucket: "tap-to-reveal.firebasestorage.app",
  messagingSenderId: "878205314791",
  appId: "1:878205314791:web:ce3c831e7075c27ca8a442"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const id = new URLSearchParams(location.search).get("id");

if (!id) {
  msg.innerText = "Invalid link";
}

db.collection("reveals").doc(id).get().then(doc => {
  if (!doc.exists) {
    msg.innerText = "Link not found";
    return;
  }

  const d = doc.data();

  if (d.mode === "one-time" && d.revealed) {
    msg.innerText = "This message was already revealed ðŸ”’";
    return;
  }

  msg.innerText = d.message;

  if (d.mode === "one-time") {
    db.collection("reveals").doc(id).update({ revealed:true });
  }
});
</script>

</body>
</html>

