<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>A Little Surprise üíñ</title>

<style>
body{
  margin:0;
  height:100vh;
  background:linear-gradient(180deg,#ff9a9e,#fad0c4);
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:sans-serif;
  overflow:hidden;
}

.card{
  background:white;
  padding:28px;
  border-radius:20px;
  width:90%;
  max-width:360px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
}

h1{ color:#e63946; }

.heart{
  width:90px;
  height:90px;
  background:#ff4d6d;
  transform:rotate(-45deg);
  margin:20px auto;
  position:relative;
  cursor:pointer;
  animation:pulse 1.3s infinite;
}
.heart::before,
.heart::after{
  content:"";
  width:90px;
  height:90px;
  background:#ff4d6d;
  border-radius:50%;
  position:absolute;
}
.heart::before{ top:-45px; left:0; }
.heart::after{ left:45px; top:0; }

@keyframes pulse{
  0%{transform:scale(1) rotate(-45deg);}
  50%{transform:scale(1.1) rotate(-45deg);}
  100%{transform:scale(1) rotate(-45deg);}
}

.hidden{display:none;}
video,audio{width:100%;border-radius:12px;margin-top:15px;}
</style>
</head>

<body>
<div class="card">
  <h1>A Little Surprise üíù</h1>
  <p id="hint">Tap the heart ‚ù§Ô∏è</p>

  <div class="heart" id="revealBtn"></div>

  <div id="content" class="hidden"></div>
  <small>Made with love ‚ú®</small>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyDAlt16C36DGhonXf10URIhz82LroH2k3A",
  authDomain: "tap-to-reveal.firebaseapp.com",
  projectId: "tap-to-reveal",
  storageBucket: "tap-to-reveal.firebasestorage.app",
  messagingSenderId: "878205314791",
  appId: "1:878205314791:web:ce3c831e7075c27ca8a442"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const id = new URLSearchParams(window.location.search).get("id");
const content = document.getElementById("content");
const btn = document.getElementById("revealBtn");

btn.onclick = async () => {
  const snap = await getDoc(doc(db,"links",id));
  if(!snap.exists()) return;

  const msg = snap.data().message;

  document.getElementById("hint").remove();
  btn.remove();
  content.classList.remove("hidden");

  // üîπ MEDIA AUTO-DETECTION
  if(msg.match(/\.(mp3|wav)$/)){
    content.innerHTML = `<audio controls autoplay src="${msg}"></audio>`;
  }
  else if(msg.includes("youtube.com") || msg.includes("youtu.be")){
    const vid = msg.split("v=")[1]?.split("&")[0] || msg.split("/").pop();
    content.innerHTML =
      `<video controls autoplay>
        <source src="https://www.youtube.com/embed/${vid}">
      </video>
      <p><a href="${msg}" target="_blank">Open video ‚ù§Ô∏è</a></p>`;
  }
  else if(msg.match(/\.(mp4|webm)$/)){
    content.innerHTML = `<video controls autoplay src="${msg}"></video>`;
  }
  else{
    content.innerHTML = `<p style="font-size:18px">${msg} üíñ</p>`;
  }

  await updateDoc(doc(db,"links",id),{ revealed:true });
};
</script>
</body>
</html>
